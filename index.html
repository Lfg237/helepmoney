<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HelepMoney</title>

<!-- üîó Lien vers le manifest PWA -->
<link rel="manifest" href="/manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
<meta name="theme-color" content="#ff5722">

<style>
body{font-family:'Arial',sans-serif;background:linear-gradient(120deg,#f6d365,#fda085);margin:0;padding:0;}
.container{max-width:900px;margin:30px auto;padding:20px;background:rgba(255,255,255,0.95);border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
h1,h2,h3{color:#ff5722;text-align:center;}
b{font-weight:bold;}
.hidden{display:none;}
input,button,textarea{width:100%;padding:10px;margin:5px 0;border-radius:5px;border:2px solid #ff5722;}
button{background:#ff5722;color:white;font-weight:bold;cursor:pointer;border:none;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:8px;text-align:center;border:1px solid #ddd;}
th{background:#ff9800;color:white;}
tr:hover{background:#ffe0b2;cursor:pointer;}
ul{list-style:none;padding:0;}
li{padding:5px;background:#ffd54f;margin:3px 0;border-radius:5px;}

/* Bande annonce d√©filante */
#bandeTexte {
  display:inline-block;
  padding-left:100%;
  animation: defilement 15s linear infinite;
  color:white;
  font-weight:bold;
  font-size:16px;
}
@keyframes defilement {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}
</style>
</head>
<body>

<!-- Section Admin -->
<div class="container" id="adminSection">
<h1><b>HelepMoney - Administration</b></h1>
<label>Code Admin :</label>
<input type="password" id="adminCode">
<button id="accessBtn">Acc√©der</button>
<p id="accessMsg"></p>
<table>
<thead>
<tr>
<th>Entreprise</th>
<th>Propri√©taire</th>
<th>Num√©ros</th>
<th>Lien abonn√©</th>
<th>√âtat</th>
</tr>
</thead>
<tbody id="adminTable"></tbody>
</table>
</div>

<!-- Section Utilisateur -->
<div class="container hidden" id="userSection">
  <div id="bandeAnnonce" style="width:100%;overflow:hidden;background:#ff9800;padding:10px 0;white-space:nowrap;box-sizing:border-box;">
    <span id="bandeTexte">üü† Promotion üü£ ‚Äì Bienvenue sur HelepMoney ! Partagez vos infos de paiement sur toutes les plateformes, mon√©tisez vos sites web, liens et groupes cr√©√© ton compte gratuitement contact administration WhatsApp üî• Infoline: 651475255 Yde nyom3</span>
  </div>

<h1><b>HelepMoney</b></h1>
<input type="text" id="searchAbonne" placeholder="Rechercher un abonn√©...">
<ul id="abonneList"></ul>

<div id="abonneDetail" class="hidden">
<h3 id="abonneNom"></h3>
<p><b>Entreprise :</b> <span id="abonneEntreprise"></span></p>
<p><b>Propri√©taire :</b> <span id="abonneProprietaire"></span></p>
<p><b>Num√©ros :</b> <span id="abonneComptes"></span></p>
<textarea id="messagePaiement" rows="4" placeholder="Collez le message Mobile Money"></textarea>
<button id="validerPaiement">Valider le paiement</button>
<p id="msgPaiement"></p>
<button id="retourAdmin">Retour Administration</button>
</div>
</div>

<script>
const ADMIN_CODE = "233233";

// Liste des abonn√©s
const abonn√©s = [
  {id:"A001", entreprise:"Boutique Alpha", proprietaire:"Jean Dupont", numeros:{om:"690112233", momo:"677889900"}, ouvert:true, transactions:[]},
  {id:"A002", entreprise:"Ma√ßonnerie BTP", proprietaire:"Kegni Isma√´l", numeros:{om:"656207273", momo:"674556677"}, ouvert:true, transactions:[]},
  {id:"A003", entreprise:"Lesfacilitateurs groupe administrateur", proprietaire:"kono emini Michel", numeros:{om:"656050097", momo:"651475255"}, ouvert:true, transactions:[]}
];

const transactionsUtilisees = [];
const adminSection = document.getElementById("adminSection");
const userSection = document.getElementById("userSection");
const adminTable = document.getElementById("adminTable");
const accessBtn = document.getElementById("accessBtn");
const adminCodeInput = document.getElementById("adminCode");
const accessMsg = document.getElementById("accessMsg");
const searchAbonne = document.getElementById("searchAbonne");
const abonneList = document.getElementById("abonneList");
const abonneDetail = document.getElementById("abonneDetail");
const abonneNom = document.getElementById("abonneNom");
const abonneEntreprise = document.getElementById("abonneEntreprise");
const abonneProprietaire = document.getElementById("abonneProprietaire");
const abonneComptes = document.getElementById("abonneComptes");
const messagePaiement = document.getElementById("messagePaiement");
const validerPaiement = document.getElementById("validerPaiement");
const msgPaiement = document.getElementById("msgPaiement");
const retourAdmin = document.getElementById("retourAdmin");

// Mise √† jour table admin
function updateAdminTable(){
  adminTable.innerHTML = "";
  abonn√©s.forEach(a => {
    const lien = `?abonne=${a.id}`;
    const btnEtat = a.ouvert ? 'Ouvert' : 'Ferm√©';
    const lienHTML = a.ouvert ? `<a href="${lien}">Voir</a>` : `<span style="color:gray;cursor:not-allowed;">Voir</span>`;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${a.entreprise}</td><td>${a.proprietaire}</td><td>OM:${a.numeros.om} | MoMo:${a.numeros.momo}</td><td>${lienHTML}</td><td>${btnEtat}</td>`;
    adminTable.appendChild(tr);
  });
}

// Acc√®s admin
accessBtn.addEventListener("click", ()=>{
  if(adminCodeInput.value.trim() === ADMIN_CODE){ 
    accessMsg.textContent="‚úÖ Acc√®s autoris√©"; 
    updateAdminTable(); 
  } else { 
    accessMsg.textContent="‚ùå Code incorrect"; 
  }
});

// Afficher abonn√©
function showAbonne(a){
  if(!a.ouvert) return;
  abonneDetail.classList.remove("hidden");
  abonneNom.textContent = a.proprietaire;
  abonneEntreprise.textContent = a.entreprise;
  abonneProprietaire.textContent = a.proprietaire;
  abonneComptes.textContent = `OM:${a.numeros.om} | MoMo:${a.numeros.momo}`;
  abonneNom.dataset.id = a.id;
  messagePaiement.value = "";
  msgPaiement.textContent = "";
  adminSection.classList.add("hidden");
  userSection.classList.remove("hidden");
}

// Recherche
searchAbonne.addEventListener("input", ()=>{
  const val = searchAbonne.value.toLowerCase();
  abonneList.innerHTML = "";
  abonn√©s.filter(a => a.proprietaire.toLowerCase().includes(val) || a.entreprise.toLowerCase().includes(val))
          .forEach(a => {
            if(a.ouvert){
              const li = document.createElement("li");
              li.textContent = `${a.proprietaire} (${a.entreprise})`;
              li.addEventListener("click", ()=> showAbonne(a));
              abonneList.appendChild(li);
            }
          });
});

// Valider paiement et ouvrir page de l'abonn√©
validerPaiement.addEventListener("click", ()=>{
  const message = messagePaiement.value.trim();
  if(!message){ msgPaiement.textContent="Veuillez coller le message MoMo."; return; }

  const ab = abonn√©s.find(a => a.id === abonneNom.dataset.id);
  if(!ab){ msgPaiement.textContent="Abonn√© introuvable."; return; }

  if(!message.toLowerCase().includes(ab.proprietaire.toLowerCase()) || 
     (!message.includes(ab.numeros.om) && !message.includes(ab.numeros.momo))){
    msgPaiement.textContent="Le paiement ne correspond pas √† cet abonn√©."; 
    return;
  }

  const regex = /transaction\s*id\s*[:\-]?\s*(\d+)/i;
  const match = message.match(regex);
  if(!match){ msgPaiement.textContent="ID transaction non trouv√©."; return; }
  
  const idTransaction = match[1];
  if(transactionsUtilisees.includes(idTransaction)){ 
    msgPaiement.textContent= "Cette transaction a d√©j√† √©t√© utilis√©e : paiement non valide."; 
    return; 
  }

  transactionsUtilisees.push(idTransaction);
  ab.transactions.push({id: idTransaction});
  msgPaiement.textContent = `‚úÖ Paiement valid√© pour ${ab.proprietaire}`;
  messagePaiement.value = "";

  // Ouvrir automatiquement la page de l'abonn√©
  window.location.href = `?abonne=${ab.id}`;
});

// Retour admin
retourAdmin.addEventListener("click", ()=>{
  userSection.classList.add("hidden");
  adminSection.classList.remove("hidden");
  abonneDetail.classList.add("hidden");
});

// Ouvrir par d√©faut abonn√© A001
window.addEventListener("load", ()=>{
  const params = new URLSearchParams(window.location.search);
  let idAbonne = params.get("abonne") || "A001";
  const ab = abonn√©s.find(a => a.id === idAbonne);
  if(ab && ab.ouvert) showAbonne(ab);
});
</script>
</body>
</html>