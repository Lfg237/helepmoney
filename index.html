<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HelpMoney - Administration</title>
<style>
body{font-family:'Arial',sans-serif;background:linear-gradient(120deg,#f6d365,#fda085);margin:0;padding:0;}
.container{max-width:900px;margin:50px auto;padding:20px;background:rgba(255,255,255,0.95);border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
h1{text-align:center;color:#ff5722;text-shadow:1px 1px #ffe0b2;}
input,button{width:100%;padding:10px;margin-bottom:10px;border-radius:5px;border:2px solid #ff5722;}
button{background:#ff5722;color:white;cursor:pointer;border:none;font-weight:bold;}
.error{color:red;text-align:center;}
.success{color:green;text-align:center;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:8px;text-align:center;border:1px solid #ddd;}
th{background:#ff9800;color:white;}
</style>
</head>
<body>
<div class="container">
<h1>üìã Tableau Administrateur</h1>
<label>Code Admin :</label>
<input type="password" id="adminCode">
<button id="accessBtn">Acc√©der</button>
<p id="accessMsg"></p>
<table>
<thead>
<tr>
<th>Entreprise</th>
<th>Propri√©taires</th>
<th>Comptes</th>
<th>Montants</th>
<th>Montants restants</th>
<th>Paiements valid√©s</th>
<th>Total re√ßu</th>
<th>Lien unique</th>
<th>Ouvert/Ferm√©</th>
</tr>
</thead>
<tbody id="adminTable"></tbody>
</table>
</div>
<script>
const ADMIN_CODE="233233";
const abonn√©s=[
  {entreprise:"FACILITATEURS",proprietaires:["Jean Dupont"],comptes:[{numero:"655123456",fournisseur:"Orange Money"},{numero:"677889900",fournisseur:"MTN MoMo"}],montants:["2000","3000"],id:"123456",ouvert:true},
  {entreprise:"TECH SOLUTIONS",proprietaires:["LOVELINE KINYUY WIRNKAR"],comptes:[{numero:"676353859",fournisseur:"MTN MoMo"},{numero:"699001122",fournisseur:"Orange Money"}],montants:["50","25","55"],id:"654321",ouvert:false}
];
const STORAGE_ETAT="etatPaiements_v3";
const STORAGE_TX="processedTxIds_v3";
const etatPaiements=JSON.parse(localStorage.getItem(STORAGE_ETAT))||{};
const processedTxIds=JSON.parse(localStorage.getItem(STORAGE_TX))||{};
abonn√©s.forEach(a=>{if(!etatPaiements[a.id])etatPaiements[a.id]={montantsRestants:[...a.montants],compteur:0,totalDepenses:0};});

const accessBtn=document.getElementById("accessBtn");
const adminCodeInput=document.getElementById("adminCode");
const accessMsg=document.getElementById("accessMsg");
const adminTable=document.getElementById("adminTable");

function updateAdminTable(){
  adminTable.innerHTML="";
  abonn√©s.forEach(a=>{
    const et=etatPaiements[a.id];
    const comptesStr=a.comptes.map(c=>c.fournisseur+": "+c.numero).join(" | ");
    const proprStr=a.proprietaires.join(", ");
    const lien=`abonne.html?abonne=${a.id}`;
    const btnOuvert=`<button onclick="toggleAbonne('${a.id}')">${a.ouvert?'Fermer':'Ouvrir'}</button>`;
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${a.entreprise}</td><td>${proprStr}</td><td>${comptesStr}</td><td>${a.montants.join(", ")}</td><td>${et.montantsRestants.join(", ")||"Aucun"}</td><td>${et.compteur}</td><td>${et.totalDepenses}</td><td><a href="${lien}" target="_blank">Lien abonn√©</a></td><td>${btnOuvert}</td>`;
    adminTable.appendChild(tr);
  });
}

window.toggleAbonne=function(id){
  const ab=abonn√©s.find(a=>a.id===id);
  if(!ab)return;
  ab.ouvert=!ab.ouvert;
  localStorage.setItem("abonn√©s_ouvertures",JSON.stringify(abonn√©s.map(a=>({id:a.id,ouvert:a.ouvert}))));
  updateAdminTable();
}

accessBtn.addEventListener("click",()=>{
  if(adminCodeInput.value.trim()===ADMIN_CODE){ accessMsg.textContent="‚úÖ Acc√®s autoris√©"; accessMsg.className="success"; updateAdminTable(); }
  else{ accessMsg.textContent="‚ùå Code incorrect"; accessMsg.className="error"; }
});

const abonn√©sOuvertures=JSON.parse(localStorage.getItem("abonn√©s_ouvertures"))||[];
abonn√©sOuvertures.forEach(o=>{const ab=abonn√©s.find(a=>a.id===o.id); if(ab) ab.ouvert=o.ouvert;});
</script>
</body>
</html>