<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’š HelepMoney - Accueil</title>
<style>
body{margin:0;font-family:'Poppins',sans-serif;background:#0b0f19;color:#f1f5f9;display:flex;justify-content:center;padding:20px;}
.container{background:#141b2e;padding:20px;border-radius:20px;width:95%;max-width:500px;box-shadow:0 0 20px rgba(0,0,0,0.5);}
h2{color:#10b981;margin-bottom:10px;text-align:center;}
input,select,button,textarea{padding:10px;margin:5px;border-radius:8px;border:none;outline:none;font-size:14px;width:100%;}
button{background:linear-gradient(90deg,#2563eb,#10b981);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;transform:scale(0.98);}
.hidden{display:none;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:10px;border:1px solid #333;text-align:center;}
th{background:#2563eb;}
.blocked{background:#f87171;}
.unblocked{background:#10b981;}
.delete{background:#ef4444;}
</style>
</head>
<body>
<div class="container">

<h2>ğŸ’š HelepMoney - Accueil</h2>

<h3>CrÃ©er un compte</h3>
<input type="text" id="name" placeholder="Nom complet">
<input type="text" id="phone" placeholder="NumÃ©ro mobile">
<input type="text" id="company" placeholder="Entreprise">
<input type="text" id="services" placeholder="Prestations">
<button onclick="createAccount()">â• CrÃ©er le compte</button>
<div id="create-status" style="margin-top:10px;color:#10b981;"></div>

<hr>
<h3>ğŸ’¼ AccÃ¨s Administrateur</h3>
<input type="password" id="admin-code" placeholder="Code admin">
<button onclick="loginAdmin()">ğŸ”‘ AccÃ¨s Admin</button>
<div id="admin-status" style="margin-top:10px;color:#10b981;"></div>

<div id="admin-panel" class="hidden">
  <table>
    <thead>
      <tr>
        <th>Nom</th>
        <th>NumÃ©ro</th>
        <th>Entreprise</th>
        <th>Prestations</th>
        <th>BloquÃ©</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="user-table"></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
const SUPABASE_URL = 'https://ycotvgvevyfyqflicmtw.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inljb3R2Z3ZldnlmeXFmbGljbXR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMTQxMzIsImV4cCI6MjA3NTY5MDEzMn0.Yyod-LWZVv5t5PggZ1EZm83vgkvHgaJd2QFJe4_vMDQ';
const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ---------------- CrÃ©ation de compte ----------------
async function createAccount(){
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const company = document.getElementById("company").value.trim();
  const services = document.getElementById("services").value.trim();
  if(!name || !phone){ alert("Nom et numÃ©ro requis"); return; }

  const id = "U"+Date.now(); // ID unique
  const { data, error } = await supabase.from('users').insert([{id,name,phone,company_name:company,services,blocked:false}]).select().single();
  if(error){ alert("Erreur : "+error.message); return; }

  localStorage.setItem("helepmoney_user", JSON.stringify(data));
  document.getElementById("create-status").textContent = `âœ… Compte crÃ©Ã© ! Lien de votre page : ${window.location.origin}/user.html?user=${data.id}`;
  document.getElementById("name").value="";
  document.getElementById("phone").value="";
  document.getElementById("company").value="";
  document.getElementById("services").value="";
}

// ---------------- Admin ----------------
function loginAdmin(){
  const code = document.getElementById("admin-code").value;
  if(code !== "233233"){ alert("Code incorrect âŒ"); return; }
  document.getElementById("admin-status").textContent = "âœ… AccÃ¨s autorisÃ©";
  document.getElementById("admin-panel").classList.remove("hidden");
  loadUsersAdmin();
}

async function loadUsersAdmin(){
  const { data, error } = await supabase.from('users').select().order('created_at',{ascending:true});
  const tbody = document.getElementById("user-table");
  tbody.innerHTML = "";
  data.forEach(u=>{
    tbody.innerHTML += `
      <tr>
        <td>${u.name}</td>
        <td>${u.phone}</td>
        <td>${u.company_name || "-"}</td>
        <td>${u.services || "-"}</td>
        <td>${u.blocked ? "âœ…" : "âŒ"}</td>
        <td>
          <button class="${u.blocked?'unblocked':'blocked'}" onclick="toggleBlockAdmin('${u.id}',${u.blocked})">${u.blocked?'DÃ©bloquer':'Bloquer'}</button>
          <button class="delete" onclick="deleteUserAdmin('${u.id}')">Supprimer</button>
        </td>
      </tr>
    `;
  });
}

async function toggleBlockAdmin(id, currentlyBlocked){
  const { error } = await supabase.from('users').update({blocked: !currentlyBlocked}).eq('id', id);
  if(error){ alert("Erreur : "+error.message); return; }
  loadUsersAdmin();
}

async function deleteUserAdmin(id){
  if(!confirm("Voulez-vous vraiment supprimer ce compte ?")) return;
  const { error } = await supabase.from('users').delete().eq('id', id);
  if(error){ alert("Erreur : "+error.message); return; }
  loadUsersAdmin();
}
</script>
</div>
</body>
</html>